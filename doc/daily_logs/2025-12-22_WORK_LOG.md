# Daily Work Log - 2025-12-22

## 📝 작업 요약 (Summary)

오늘은 **KRX API 기반 데이터 아키텍처 개선** 및 **Python 마이크로서비스 도입**에 집중했습니다.
기존 클라이언트 측의 불안정한 KRX 폴백 로직을 제거하고, 서버 사이드(Admin Tool) 주도의 안정적인 데이터 파이프라인을 구축했습니다.

### 1. Market Data Logic Refactoring
- **문제**: `market-data.ts`에서 야후 파이낸스 실패 시 KRX API를 직접 호출하여 타임아웃 및 서버 에러 빈발.
- **해결**: 클라이언트 코드에서 KRX 폴백 함수(`getKRXData`)를 제거. 야후 파이낸스와 Supabase 캐시만 사용하도록 경량화.

### 2. Python Microservice 도입 (`stock-data-service`)
- **목적**: `pykrx` 라이브러리를 활용하여 **실시간 시세** 및 **투자자별 수급(개인/외국인/기관)** 데이터 확보.
- **구현**:
    - `miniconda` 기반의 독립 가상환경 구성.
    - `generate_stock_list.py`: KOSPI/KOSDAQ 전 종목 리스트 생성 및 `src/data/stocks.json` 자동 업데이트 (초성 검색 지원).
    - `main.py`: 종목별 시세 및 수급 데이터 조회 후 Supabase `analysis_cache` 테이블 Upsert.

### 3. Admin Tools 고도화 (`admin-tools`)
- Python 서비스를 호출하는 NPM 명령어 통합:
    - `npm run gen-list`: 종목 리스트 최신화.
    - `npm run sync-all-stocks`: 전 종목 시세/수급 데이터 DB 동기화.

## ✅ 완료된 작업 (Completed)
- [x] Client: KRX 폴백 로직 제거 및 에러 핸들링 개선.
- [x] Service: Python `pykrx` 환경 구축 (Conda).
- [x] Feature: 초성 검색용 데이터(`chosung`) 포함한 주식 목록 생성기 구현.
- [x] Feature: 투자자별(개인/외국인/기관) 매매 동향 데이터 연동.
- [x] Infra: `admin-tools`와 Python 서비스 간 명령어 연동.
- [x] Doc: 배포 가이드(`DEPLOYMENT.md`) 및 Admin 가이드(`ADMIN_TOOLS_GUIDE_KR.md`) 작성.

## 📌 TODO List (Remaining Tasks)

### 1. Client UI Update
- **투자자 수급 표시**: DB에는 수급 데이터(`investor_individual` 등)가 저장되고 있으나, 현재 웹 UI(차트 혹은 상세 페이지)에는 표시되지 않고 있습니다. 이를 시각화하는 작업이 필요합니다.
- **데이터 출처 표시**: 데이터가 Yahoo Finance 실시간인지, Admin Tool에 의한 과거(혹은 당일 마감) 데이터인지 사용자에게 알리는 UI가 필요할 수 있습니다.

### 2. Automation
- **Scheduler 설정**: `npm run sync-all-stocks`를 매일 장 마감 후(16:00) 자동으로 실행하도록 OS 스케줄러(Windows Task Scheduler 등) 등록이 필요합니다.

### 3. ETF Support
- **ETF 데이터 연동**: 현재 주식(KOSPI/KOSDAQ) 위주로 구현되어 있습니다. ETF도 `pykrx`를 통해 목록 생성 및 데이터 동기화 로직에 포함시킬지 결정해야 합니다.
